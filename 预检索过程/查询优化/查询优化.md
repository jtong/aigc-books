## 查询优化

查询优化是预检索过程中的一个关键环节，旨在改进用户查询的表达，使其更适合检索任务。下面解释查询优化的主要方法：

### 查询扩展

查询扩展通过丰富原始查询的内容，提供更多的上下文信息，以解决查询中可能缺失的细微差别，从而确保生成答案的最佳相关性。常见的查询扩展方法包括：

1. **多查询**：通过提示工程扩展查询，可以让LLM（大型语言模型）生成多个相关查询，然后并行执行这些查询。这些扩展查询是经过精心设计的，不是随机生成的，从而确保每个查询都能补充原始查询的信息。

2. **子查询**：将复杂问题分解为一系列更简单的子问题，这一过程被称为子问题规划。每个子问题都用于补充原始问题的上下文，从而更全面地回答原始问题。常见的方法包括最少到最多提示法，将复杂问题逐步分解为简单子问题。

3. **验证链（CoVe）**：扩展的查询通过LLM进行验证，以减少幻觉（即生成不受支持的内容）。验证过的扩展查询通常表现出更高的可靠性和准确性。

### 查询转换

查询转换的核心概念是基于转换后的查询而不是用户的原始查询来进行检索。这种方法可以显著提高检索结果的相关性和准确性。常见的方法包括：

1. **查询重写**：原始查询不总是最佳的检索选择，特别是在现实场景中。因此，可以使用LLM或专门的小型语言模型将原始查询重写为更适合检索的形式。例如，淘宝的BEQUE系统通过查询重写显著提高了长尾查询的召回率。

2. **生成查询**：通过提示工程让LLM根据原始查询生成新的查询进行检索。例如，HyDE方法构建假设文档（假设答案），专注于从答案到答案的嵌入相似性，而不是问题或查询的嵌入相似性。Step-back Prompting方法将原始查询抽象为生成一个高层次概念问题（Step-back问题），并将其与原始查询一起用于检索。

### 查询路由

查询路由基于不同的查询，将其路由到适合的不同RAG管道，适用于适应多样场景的通用RAG系统。主要方法包括：

1. **元数据路由/过滤**：从查询中提取关键词（实体），然后基于关键词和块中的元数据进行过滤，以缩小搜索范围。这种方法确保了检索结果与查询的相关性。

2. **语义路由**：利用查询的语义信息进行路由。例如，Semantic Router方法结合语义和基于元数据的方法进行查询路由，确保检索结果的高相关性和准确性。

通过以上查询优化方法，高级RAG能够更好地处理用户查询，提高检索的精度和召回率，从而生成更准确和相关的答案。